# 使用数据处理函数

## 函数

SQL可以使用函数来处理数据，函数一般是在数据上执行的，为数据的转换和处理提供了方便。

### 函数带来的问题

- 每个DBMS都有特定的函数，虽然所有类型的函数一般都可以在每个DBMS中使用，但是各个函数的名称和语法可能及其不同。
- 与SQL语句不一样，SQL函数一般都是不可移植的。

## 使用函数

大多数SQL支持一下类型的函数：

- 用于处理文本字符串（删除或填充值，转换值为大写或小写）的文本函数
- 用在数值数据上进行算术操作（绝对值，代数运算）的数值函数
- 用于处理日期和时间值并从这些值中提取特定成分（如返回两个日期之差，检查日期有效性）的日期和时间函数
- 返回DBMS正使用的特殊信息（如用户登录信息）的系统函数

### 文本处理函数

#### `upper()`函数

```sql
select vend_name, upper(vend_name) as vend_name_upcase
from Vendors
order by vend_name;
```

#### 一些常用的文本函数：

| 函数                                       | 说明                    |
| ------------------------------------------ | ----------------------- |
| `left()`(或使用子字符串函数)               | 返回字符串左边的字符    |
| `length()`（也使用`datalength()`或`len()`) | 返回字符串的长度        |
| `lower()`                                  | 将字符串转为小写        |
| `trim()`                                   | 去除两边的空格          |
| `soundex()`                                | 返回字符串的`soundex`值 |
| `upper()`                                  | 将字符串转为大写        |

表中的`soundex`是一个将任何文本串转换为描述其语音表示的字母数字模式的算法。

```SQL
select cust_name, cust_contact
from Customers
where soundex(cust_contact) = soundex("Michael Green");
```

### 日期和时间处理函数

日期和时间采用相应的数据类型存储在表中，每种DBMS都有自己的特殊形式（这样可以快速有效的排序或过滤，并节省空间），应用程序一般不使用日期和时间的存储格式，因此日期和时间函数总是用来读取、统计和处理这些值，因此日期和时间函数在SQL中有重要的作用，遗憾的是，它们不一致，可移植性最差。

```SQL
select order_num
from Orders
where year(order_date) = 2012;
```

### 数值处理函数

#### 常用的数值处理函数

| 函数 | 说明 | 
| ----- | ------- |
| `abs()` | 返回一个数的绝对值 |
| `cos()` | 返回一个角度的余弦 |
| `exp()` | 返回一个数的指数 | 
| `pi()` | 返回圆周率 |
| `sin()` | 返回一个数的正弦值 |
| `sqrt()` | 返回一个数的平方根 |
| `tan()` | 返回一个角度的正切 |