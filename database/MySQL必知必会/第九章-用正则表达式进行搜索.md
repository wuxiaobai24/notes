# 第九章-用正则表达式进行搜索

## 9.1 正则表达式介绍

> 正则表达式是用来匹配文本的特殊的串(字符集合).

正则表达式是用正则表达式语言来建立.

[正则表达式30分钟入门教程](https://deerchao.net/tutorials/regex/regex.htm)

## 9.2 使用MySQL正则表达式

##### MySQL仅仅支持多数正则表达式实现的一个很小的子集.

### 9.2.1 基本字符匹配

```mysql
mysql> SELECT emp_no
    -> FROM employees
    -> WHERE emp_no REGEXP '10000';
+--------+
| emp_no |
+--------+
| 100000 |
| 100001 |
| 100002 |
| 100003 |
| 100004 |
| 100005 |
| 100006 |
| 100007 |
| 100008 |
| 100009 |
| 110000 |
| 210000 |
| 410000 |
+--------+
13 rows in set (0.09 sec)

```

**`REGEXP`后面跟的东西是正则表达式,MySQL会按其进行搜索.**

**MySQL中的正则表达式匹配不区分大小写,如果需要区分大小写,可以在`REGEXP`和正则表达式中加上`BINARY`关键词.**

- `.`是正则表达式语言中一个特殊的字符,它表示**匹配任意一个字符**.

  ```mysql
  mysql>  SELECT emp_no
      -> FROM employees
      -> WHERE emp_no REGEXP '.00000';
  +--------+
  | emp_no |
  +--------+
  | 100000 |
  | 200000 |
  | 400000 |
  +--------+
  3 rows in set (0.09 sec)
  ```

  - LIKE与REGEXP的差别

    ```mysql
    mysql> SELECT emp_no FROM employees WHERE emp_no LIKE '10000';
    Empty set (0.08 sec)

    ```

    `LIKE`会匹配整个列,如果被匹配的文本在列值中出现,`LIKE`则不会返回它.

    而`REGEXP`在列值内进行匹配,如果被匹配的文本在列值中出现,那么他会找到它并返回.

- 为了搜索两个串之一,可以使用`|`

  ```mysql
  mysql> SELECT emp_no FROM employees WHERE emp_no REGEXP '100000|100001';
  +--------+
  | emp_no |
  +--------+
  | 100000 |
  | 100001 |
  +--------+
  2 rows in set (0.20 sec)

  ```

- 匹配几个字符之一`[]`:

  ```mysql
  mysql> SELECT emp_no FROM employees WHERE emp_no REGEXP '10000[01]';
  +--------+
  | emp_no |
  +--------+
  | 100000 |
  | 100001 |
  +--------+
  2 rows in set (0.07 sec)

  ```

  `[]`是另一种形式的**OR**语句

- 字符集的否定`^`:

  ```mysql
  mysql> SELECT emp_no FROM employees WHERE emp_no REGEXP '10000[^01]';
  +--------+
  | emp_no |
  +--------+
  | 100002 |
  | 100003 |
  | 100004 |
  | 100005 |
  | 100006 |
  | 100007 |
  | 100008 |
  | 100009 |
  +--------+
  8 rows in set (0.08 sec)

  ```

  `[^01]`的含义是匹配除'0,'1'以外的任何字符.

- 范围匹配`[1-9]`

  ```mysql
  mysql> SELECT emp_no FROM employees WHERE emp_no REGEXP '10000[0-9]';
  +--------+
  | emp_no |
  +--------+
  | 100000 |
  | 100001 |
  | 100002 |
  | 100003 |
  | 100004 |
  | 100005 |
  | 100006 |
  | 100007 |
  | 100008 |
  | 100009 |
  +--------+
  10 rows in set (0.06 sec)

  ```

  将`[123456789]`简化成`[1-9]`

- 匹配特殊字符

  由于`.`,`[]`,`|`,`-`已有特殊含义,如果需要匹配这些字符需要进行转义,转义的方法是在其前面加上**两个`//`**.

  ```mysql
  SELECT emp_no FROM employees WHERE emp_no REGEXP '\\.';

  ```

  `\\`也可以用来应用元字符(具有特殊含义的字符).

  | 元字符  |  说明  |
  | :--: | :--: |
  | \\f  |  换页  |
  | \\n  |  换行  |
  | \\r  |  回车  |
  | \\v  | 纵向制表 |

  ##### 使用`\\`的原因

  多数正则表达式实现是使用单个反斜杠转义特殊字符,但是MySQL要求两个反斜杠(MySQL自己解释一个,正则表达式库解释另一个).

- 匹配字符类

  |     类      |               说明               |
  | :--------: | :----------------------------: |
  | [:alnum:]  |     任意字母和数字(同[a-zA-Z0-9])      |
  | [:alpha:]  |        任意字母(同[a-zA-Z])         |
  | [:blank:]  |        空格和制表符(同[\\\t])         |
  | [:cntrl:]  |           ASCII控制字符            |
  | [:digit:]  |          任意数字(同[0-9])          |
  | [: graph:] |      与[:print:]相同,但不包括空格       |
  | [:lower:]  |         任意小写字母(同[a-z])         |
  | [:print:]  |            任意可打印字符             |
  | [:punct:]  | 既不在[:alumn:]又不在[:cntrl:]中的任意字符 |
  | [:space:]  |         包括空格在内的任意空白字符          |
  | [:upper:]  |         任意大写字母(同[A-Z])         |
  | [:xdigit:] |     任意十六进制数字(同[a-fA-F0-9])     |

- 匹配多个实例

  |  元字符  |          说明          |
  | :---: | :------------------: |
  |   *   |        0或多个匹配        |
  |   +   |   1个或多个匹配(等于{1,})    |
  |   ?   |   0个或1个匹配(等于{0,1})   |
  |  {n}  |        指定数目匹配        |
  | {n,}  |      不少于指定数目的匹配      |
  | {n,m} | 匹配数目的范围(**m不超过255**) |

- 定位符

  |   元字符   |  说明   |
  | :-----: | :---: |
  |    ^    | 文本的开始 |
  |    $    | 文本的结束 |
  | [[:<:]] | 词的开始  |
  | [[:>:]] | 词的结尾  |

- 使用`SELECT`来简单测试正则表达式

  ```mysql
  SELECT 'hello' REGEXP '[0-9]'
  ```

  ​